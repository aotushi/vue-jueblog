# Vue JueBlog V2 å‡çº§è®¡åˆ’ - tRPC + Hono + Cloudflare

## ğŸ¯ ç›®æ ‡

å°†é¡¹ç›®å‡çº§ä¸ºç°ä»£åŒ–çš„å…¨æ ˆ TypeScript æ¶æ„ï¼š

- **åç«¯**: Hono + tRPC + Cloudflare Workers
- **å‰ç«¯**: Vue 3 + tRPC Client + ç°ä»£åŒ– Mock æ–¹æ¡ˆ
- **éƒ¨ç½²**: Cloudflare Workers (è¾¹ç¼˜è®¡ç®—)

## ğŸ“‹ è¯¦ç»†è®¡åˆ’

### ğŸ” ç¬¬ä¸€é˜¶æ®µï¼šæŠ€æœ¯é¢„ç ” (Week 1-2)

#### 1. å­¦ä¹  tRPC + Hono + Cloudflare Workers æŠ€æœ¯æ ˆ

- **tRPC æ ¸å¿ƒæ¦‚å¿µ**: Router, Procedure, Context, Middleware
- **Hono æ¡†æ¶**: ç°ä»£åŒ– Web æ¡†æ¶ï¼ŒCloudflare Workers åŸç”Ÿæ”¯æŒ
- **Cloudflare Workers**: è¾¹ç¼˜è®¡ç®—å¹³å°ï¼Œå…¨çƒåˆ†å‘
- **å­¦ä¹ èµ„æº**:
  - [tRPC å®˜æ–¹æ–‡æ¡£](https://trpc.io/docs)
  - [Hono å®˜æ–¹æ–‡æ¡£](https://hono.dev/)
  - [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)

#### 2. ç ”ç©¶å‰ç«¯ Mock æ•°æ®æœ€ä½³å®è·µæ–¹æ¡ˆ

**å½“å‰é—®é¢˜**: `backend-mockdata` ç¹ç
**æ¨èæ–¹æ¡ˆ**:

- **MSW (Mock Service Worker)**: æ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œæ— ä¾µå…¥æ€§
- **Mirage.js**: åŠŸèƒ½å¼ºå¤§çš„å‰ç«¯ API mock åº“
- **json-server**: ç®€å•å¿«é€Ÿçš„ REST API mock
- **Vite Mock Plugin**: Vite ç”Ÿæ€çš„ mock è§£å†³æ–¹æ¡ˆ

#### 3. è®¾è®¡ Cloudflare éƒ¨ç½²æ¶æ„å’Œç¯å¢ƒé…ç½®

```
æ¶æ„è®¾è®¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vue 3 SPA     â”‚â”€â”€â”€â–¶â”‚ Cloudflare      â”‚â”€â”€â”€â–¶â”‚ External DB     â”‚
â”‚   (Static)      â”‚    â”‚ Workers         â”‚    â”‚ (PlanetScale/   â”‚
â”‚                 â”‚    â”‚ (Hono + tRPC)   â”‚    â”‚  Supabase)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ—ï¸ ç¬¬äºŒé˜¶æ®µï¼šæœåŠ¡ç«¯å¼€å‘ (Week 3-4)

#### 4. æ­å»º Hono + tRPC æœåŠ¡ç«¯åŸºç¡€æ¡†æ¶

```typescript
// é¡¹ç›®ç»“æ„
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ trpc/
â”‚   â”‚   â”œâ”€â”€ router.ts
â”‚   â”‚   â”œâ”€â”€ context.ts
â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ users.ts
â”‚   â”‚   â”œâ”€â”€ articles.ts
â”‚   â”‚   â””â”€â”€ comments.ts
â”‚   â””â”€â”€ index.ts (Hono app)
â”œâ”€â”€ wrangler.toml
â””â”€â”€ package.json
```

#### 5. é…ç½® Cloudflare Workers å¼€å‘ç¯å¢ƒ

- å®‰è£… Wrangler CLI
- é…ç½® `wrangler.toml`
- è®¾ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒ
- é…ç½®ç¯å¢ƒå˜é‡å’Œå¯†é’¥

#### 6-8. å®ç° tRPC æ¥å£ (Hono)

**ç”¨æˆ·æ¨¡å—**:

```typescript
export const userRouter = router({
  login: publicProcedure
    .input(z.object({ phone: z.string(), password: z.string() }))
    .mutation(async ({ input, ctx }) => {
      /* ... */
    }),
  register: publicProcedure.input(registerSchema).mutation(/* ... */),
  getProfile: protectedProcedure.input(z.string()).query(/* ... */),
})
```

**æ–‡ç« æ¨¡å—**:

```typescript
export const articleRouter = router({
  list: publicProcedure.input(listSchema).query(/* ... */),
  detail: publicProcedure.input(z.string()).query(/* ... */),
  create: protectedProcedure.input(articleSchema).mutation(/* ... */),
  update: protectedProcedure.input(updateSchema).mutation(/* ... */),
})
```

### ğŸ¨ ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯æ”¹é€  (Week 5-6)

#### 9. é…ç½®å‰ç«¯ç°ä»£åŒ– Mock æ•°æ®æ–¹æ¡ˆ

**æ¨è: MSW (Mock Service Worker)**

```typescript
// mocks/handlers.ts
export const handlers = [
  http.get('/api/articles', () => {
    return HttpResponse.json(mockArticles)
  }),
  http.post('/api/users/login', () => {
    return HttpResponse.json({ token: 'mock-token' })
  }),
]

// å¼€å‘ç¯å¢ƒè‡ªåŠ¨å¯ç”¨
if (import.meta.env.DEV) {
  const { worker } = await import('./mocks/browser')
  worker.start()
}
```

#### 10. é…ç½®å‰ç«¯ tRPC å®¢æˆ·ç«¯è¿æ¥ Hono æœåŠ¡

```typescript
// utils/trpc.ts
import { createTRPCVue } from '@trpc/vue'
import { httpBatchLink } from '@trpc/client'

export const trpc = createTRPCVue<AppRouter>({
  links: [
    httpBatchLink({
      url: import.meta.env.PROD
        ? 'https://your-worker.your-subdomain.workers.dev'
        : 'http://localhost:8787',
    }),
  ],
})
```

#### 11-12. æ”¹é€  Pinia Stores å’Œé¡µé¢ç»„ä»¶

```typescript
// stores/article.ts
export const useArticleStore = defineStore('article', () => {
  const { $trpc } = useNuxtApp()

  const getArticlesList = async (params: ListParams) => {
    return await $trpc.articles.list.query(params)
  }

  return { getArticlesList }
})
```

### ğŸ—„ï¸ ç¬¬å››é˜¶æ®µï¼šæ•°æ®åº“å’Œéƒ¨ç½² (Week 7)

#### 13. é…ç½®æ•°æ®åº“æ–¹æ¡ˆ

**é€‰é¡¹å¯¹æ¯”**:

- **Cloudflare D1**: å®˜æ–¹ SQLiteï¼Œå…è´¹é¢åº¦å¤§
- **PlanetScale**: MySQL å…¼å®¹ï¼Œåˆ†æ”¯ç®¡ç†
- **Supabase**: PostgreSQLï¼Œå®æ—¶åŠŸèƒ½
- **MongoDB Atlas**: NoSQLï¼Œç°æœ‰æ•°æ®å…¼å®¹

#### 14. æœ¬åœ°å¼€å‘ç¯å¢ƒä¸ Cloudflare ç¯å¢ƒè”è°ƒ

- é…ç½® `wrangler dev`
- ç¯å¢ƒå˜é‡ç®¡ç†
- æ•°æ®åº“è¿æ¥é…ç½®
- CORS å’Œè·¨åŸŸå¤„ç†

#### 15. Cloudflare Workers éƒ¨ç½²å’ŒåŸŸåé…ç½®

```bash
# éƒ¨ç½²å‘½ä»¤
wrangler publish

# è‡ªå®šä¹‰åŸŸå
wrangler route add "api.yourdomain.com/*" your-worker
```

### âœ… ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–å’Œå®Œå–„ (Week 8)

#### 16. æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†å®Œå–„

- tRPC ç¼“å­˜ç­–ç•¥
- é”™è¯¯è¾¹ç•Œå¤„ç†
- ç±»å‹å®‰å…¨éªŒè¯
- æ€§èƒ½ç›‘æ§

#### 17. æ›´æ–°é¡¹ç›®æ–‡æ¡£å’Œéƒ¨ç½²è¯´æ˜

- API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- éƒ¨ç½²æµç¨‹æ–‡æ¡£
- å¼€å‘ç¯å¢ƒæ­å»ºæŒ‡å—
- æ•…éšœæ’æŸ¥æ‰‹å†Œ

## ğŸ› ï¸ æŠ€æœ¯æ ˆå¯¹æ¯”

| æŠ€æœ¯      | V1 (å½“å‰)        | V2 (ç›®æ ‡)          |
| --------- | ---------------- | ------------------ |
| åç«¯æ¡†æ¶  | Express          | Hono               |
| API ç±»å‹  | REST             | tRPC               |
| éƒ¨ç½²å¹³å°  | ä¼ ç»ŸæœåŠ¡å™¨       | Cloudflare Workers |
| Mock æ–¹æ¡ˆ | backend-mockdata | MSW                |
| ç±»å‹å®‰å…¨  | éƒ¨åˆ†             | ç«¯åˆ°ç«¯             |
| å¼€å‘ä½“éªŒ  | ä¸€èˆ¬             | æä½³               |
| æ€§èƒ½      | ä¸€èˆ¬             | ä¼˜ç§€               |

## ğŸ“… æ—¶é—´å®‰æ’

- **Week 1-2**: æŠ€æœ¯å­¦ä¹ å’Œæ–¹æ¡ˆè°ƒç ”
- **Week 3-4**: åç«¯ Hono + tRPC å¼€å‘
- **Week 5-6**: å‰ç«¯æ”¹é€ å’Œ Mock é…ç½®
- **Week 7**: æ•°æ®åº“å’Œéƒ¨ç½²é…ç½®
- **Week 8**: æµ‹è¯•ä¼˜åŒ–å’Œæ–‡æ¡£å®Œå–„

## ğŸš€ é¢„æœŸæ”¶ç›Š

1. **å¼€å‘æ•ˆç‡**: ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ï¼Œè‡ªåŠ¨è¡¥å…¨
2. **éƒ¨ç½²æˆæœ¬**: Cloudflare Workers å…è´¹é¢åº¦å¤§
3. **æ€§èƒ½æå‡**: è¾¹ç¼˜è®¡ç®—ï¼Œå…¨çƒåˆ†å‘
4. **ç»´æŠ¤æ€§**: ç°ä»£åŒ–æ¶æ„ï¼Œä»£ç è´¨é‡é«˜
5. **æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
